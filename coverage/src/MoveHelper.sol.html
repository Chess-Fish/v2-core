<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for src/MoveHelper.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">src/</a> MoveHelper.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>0/32</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>0/6</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>0/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">0% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>0/47</span>
      </div>
    </div>
  </div>
  <div class='status-line low'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
&nbsp;
/* 
   _____ _                   ______ _     _     
  / ____| |                 |  ____(_)   | |    
 | |    | |__   ___  ___ ___| |__   _ ___| |__  
 | |    | '_ \ / _ \/ __/ __|  __| | / __| '_ \ 
 | |____| | | |  __/\__ \__ \ |    | \__ \ | | |
  \_____|_| |_|\___||___/___/_|    |_|___/_| |_|
                             
*/
&nbsp;
pragma solidity ^0.8.24;
&nbsp;
import { MoveVerification } from "./MoveVerification.sol";
&nbsp;
import "forge-std/console.sol";
/**
 * @title ChessFish MoveHelper Contract
 * @author ChessFish
 * @notice https://github.com/Chess-Fish
 *
 * @dev This contract handles move conversion functionality to the
 * MoveVerification contract as well as setting board coordinates.
 */
&nbsp;
contract MoveHelper {
    // @dev uint pieces =&gt; letter pieces
    mapping(uint8 =&gt; string) pieces;
&nbsp;
    /// @dev algebraic chess notation string =&gt; uint (0-63)
    mapping(string =&gt; uint256) public coordinates;
    mapping(uint256 =&gt; string) public squareToCoordinate;
&nbsp;
    /// @dev address deployer
    address public deployer;
&nbsp;
    /// @dev MoveVerification contract
    MoveVerification public moveVerification;
&nbsp;
    /// @dev 5% fee to token holders
    uint256 public protocolFee = 500;
&nbsp;
<span class="fstat-no" title="function not covered" >    modifier OnlyDeployer() {</span>
<span class="cstat-no" title="statement not covered" >        require(msg.sender == deployer, "Only deployer")</span>;
        _;
    }
&nbsp;
    /// @dev called from ts since hardcoding the mapping makes the contract too
    /// large
<span class="fstat-no" title="function not covered" >    function initCoordinatesAndSymbols(</span>
        string[64] calldata coordinate,
        uint256[64] calldata value,
        string[13] calldata pieceSymbols
    )
        external
        OnlyDeployer
    {
<span class="cstat-no" title="statement not covered" >        for (int256 i = 0; i &lt; 64; i++) {</span>
            coordinates[coordinate[uint256(i)]] = value[uint256(i)];
            squareToCoordinate[value[uint256(i)]] = coordinate[uint256(i)];
        }
        /* 		
        pieces[0] = ".";
&nbsp;
        // white pieces
        pieces[1] = "P";
        pieces[2] = "B";
        pieces[3] = "N";
        pieces[4] = "R";
        pieces[5] = "Q";
        pieces[6] = "K";
&nbsp;
        // black pieces
        pieces[9] = "p";
        pieces[10] = "b";
        pieces[11] = "n";
        pieces[12] = "r";
        pieces[13] = "q";
        pieces[14] = "k";
        */
<span class="cstat-no" title="statement not covered" >        for (uint8 i = 0; i &lt; 13; i++) {</span>
<span class="cstat-no" title="statement not covered" >            if (i &gt;= 7) {</span>
                pieces[i + 2] = pieceSymbols[i];
            } else {
                pieces[i] = pieceSymbols[i];
            }
        }
    }
&nbsp;
    /// @dev Convert the number of a piece to the string character
    /// @param piece is the number of the piece
    /// @return string is the letter of the piece
<span class="fstat-no" title="function not covered" >    function getLetter(uint8 piece) public view returns (string memory) {</span>
<span class="cstat-no" title="statement not covered" >        string memory letter = pieces[piece];</span>
<span class="cstat-no" title="statement not covered" >        return letter;</span>
    }
&nbsp;
    /// @dev Converts a move from a 16-bit integer to a 2 8-bit integers.
    /// @param move is the move to convert
    /// @return fromPos and toPos
<span class="fstat-no" title="function not covered" >    function convertFromMove(uint16 move) public pure returns (uint8, uint8) {</span>
<span class="cstat-no" title="statement not covered" >        uint8 fromPos = (uint8)((move &gt;&gt; 6) &amp; 0x3f);</span>
<span class="cstat-no" title="statement not covered" >        uint8 toPos = (uint8)(move &amp; 0x3f);</span>
<span class="cstat-no" title="statement not covered" >        return (fromPos, toPos);</span>
    }
&nbsp;
    /// @dev Converts two 8-bit integers to a 16-bit integer
    /// @param fromPos is the position to move a piece from.
    /// @param toPos is the position to move a piece to.
    /// @return move
<span class="fstat-no" title="function not covered" >    function convertToMove(uint8 fromPos, uint8 toPos) public pure returns (uint16) {</span>
<span class="cstat-no" title="statement not covered" >        uint16 move = (uint16)(fromPos);</span>
        move = move &lt;&lt; 6;
        move = move + (uint16)(toPos);
<span class="cstat-no" title="statement not covered" >        return move;</span>
    }
&nbsp;
    /// @dev Converts an algebraic chess notation string move to uint16 format
    /// @param move is the move to convert i.e. e2e4 to hex move
    /// @return hexMove is the resulting uint16 value
<span class="fstat-no" title="function not covered" >    function moveToHex(string memory move) external view returns (uint16 hexMove) {</span>
<span class="cstat-no" title="statement not covered" >        bytes memory byteString = bytes(move);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        bytes memory bFromPos = "00";</span>
<span class="cstat-no" title="statement not covered" >        bytes memory bToPos = "00";</span>
&nbsp;
        bFromPos[0] = byteString[0];
        bFromPos[1] = byteString[1];
&nbsp;
        bToPos[0] = byteString[2];
        bToPos[1] = byteString[3];
&nbsp;
<span class="cstat-no" title="statement not covered" >        string memory sFromPos = string(bFromPos);</span>
<span class="cstat-no" title="statement not covered" >        string memory sToPos = string(bToPos);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        uint8 fromPos = uint8(coordinates[sFromPos]);</span>
<span class="cstat-no" title="statement not covered" >        uint8 toPos = uint8(coordinates[sToPos]);</span>
&nbsp;
        hexMove = convertToMove(fromPos, toPos);
&nbsp;
<span class="cstat-no" title="statement not covered" >        return hexMove;</span>
    }
&nbsp;
    /// @dev Converts a uint16 hex value to move in algebraic chess notation
    /// @param hexMove is the move to convert to string
    /// @return move is the resulting string value
<span class="fstat-no" title="function not covered" >    function hexToMove(uint16 hexMove) public view returns (string memory move) {</span>
<span class="cstat-no" title="statement not covered" >        uint8 fromPos = uint8(hexMove &gt;&gt; 6);</span>
<span class="cstat-no" title="statement not covered" >        uint8 toPos = uint8(hexMove &amp; 0x3f);</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        string memory fromCoord = squareToCoordinate[fromPos];</span>
<span class="cstat-no" title="statement not covered" >        string memory toCoord = squareToCoordinate[toPos];</span>
&nbsp;
        move = string(abi.encodePacked(fromCoord, toCoord));
&nbsp;
<span class="cstat-no" title="statement not covered" >        return move;</span>
    }
&nbsp;
    /// @dev returns string of letters representing the board
    /// @dev only to be called by user or ui
    /// @param gameState is the uint256 game state of the board
    /// @return string[64] is the resulting array
<span class="fstat-no" title="function not covered" >    function getBoard(uint256 gameState) public view returns (string[64] memory) {</span>
<span class="cstat-no" title="statement not covered" >        string[64] memory board;</span>
<span class="cstat-no" title="statement not covered" >        uint256 j = 0;</span>
&nbsp;
<span class="cstat-no" title="statement not covered" >        for (uint256 i = 0; i &lt;= 7; i++) {</span>
<span class="cstat-no" title="statement not covered" >            int256 pos = ((int256(i) + 1) * 8) - 1;</span>
<span class="cstat-no" title="statement not covered" >            int256 last = pos - 7;</span>
<span class="cstat-no" title="statement not covered" >            for (pos; pos &gt;= last; pos--) {</span>
<span class="cstat-no" title="statement not covered" >                uint8 piece =</span>
                    moveVerification.pieceAtPosition(gameState, uint8(uint256(pos)));
&nbsp;
                board[j] = getLetter(piece);
&nbsp;
                j++;
            }
        }
<span class="cstat-no" title="statement not covered" >        return board;</span>
    }
}
&nbsp;</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Feb 19 2024 08:25:22 GMT+0300 (Moscow Standard Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
